# 整体架构

Seele 评测系统分为两个组成部分：评测服务和安全沙箱。评测服务作为服务进程，接收用户提交的请求并产生安全沙箱子进程来运行评测程序。
评测系统的整体架构如下图所示：

![Seele 架构图](/architecture.jpg)

其中，评测服务使用 [Rust](https://www.rust-lang.org/) 语言编写，基于流行的高性能异步编程框架 [Tokio](https://tokio.rs/)。
Rust 语言通过其独特的所有权系统和内存安全特性，让人们在使用它编写高性能应用程序时能够更加安全、高效地管理内存，避免应用程序因为内存问题而崩溃。
此外，Rust 也拥有出色的并发性能和可伸缩性，使得它成为编写高吞吐量和高并发性能应用程序的理想选择。
Tokio 框架为 Rust 语言带来了高性能的异步运行时实现，提供了基于事件驱动的非阻塞 I/O 模型，能够让评测服务高效地处理大量 I/O 任务。

对于安全沙箱，它使用 [Go](https://go.dev/) 语言编写，基于著名的容器运行时 [runc](https://github.com/opencontainers/runc/)。参见[安全沙箱](/advanced/sandbox)。

## Exchange

Exchange 接收用户提交的评测任务，将其交给 Composer，然后将 Composer 发送的评测报告反馈给用户。为了提升灵活性，评测系统允许用户配置多个 Exchange 共同工作。
目前，评测服务提供了两种 Exchange 的实现，为用户提供了多种与评测系统进行数据交互的方式。

## Composer

Composer 接收来自 Exchange 的评测任务，解析评测任务并生成一棵由步骤构成的多叉树，从沿着这棵树从根部开始向 Worker 发送步骤，追踪步骤的执行。
当无法再沿着多叉树执行更多步骤时，评测任务执行完毕，Composer 此时汇总数据产生评测报告并发送给 Exchange。

## Worker

Worker 接收 Composer 发来的执行步骤，并根据其中的配置执行对应的任务，最后将执行报告发送给 Composer。目前，Worker 中提供了两种任务：添加文件和运行容器。
在运行容器任务中，Worker 通过 [skopeo](https://github.com/containers/skopeo) 从用户指定的镜像源中拉取镜像到本地，然后通过 [umoci](https://github.com/opencontainers/umoci) 将镜像解压。
Worker 会通过调用安全沙箱程序来启动容器、运行评测程序并收集报告。
